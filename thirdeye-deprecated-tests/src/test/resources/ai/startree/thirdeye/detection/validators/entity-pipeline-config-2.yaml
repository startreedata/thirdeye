#
# Copyright 2022 StarTree Inc
#
# Licensed under the StarTree Community License (the "License"); you may not use
# this file except in compliance with the License. You may obtain a copy of the
# License at http://www.startree.ai/legal/startree-community-license
#
# Unless required by applicable law or agreed to in writing, software distributed under the
# License is distributed on an "AS IS" BASIS, WITHOUT * WARRANTIES OF ANY KIND,
# either express or implied.
# See the License for the specific language governing permissions and limitations under
# the License.
#

detectionName: testPipeline
description: My test pipeline
type: COMPOSITE_ALERT
cron: "0 0 14 * * ? *"
alerts:
  - type: METRIC_ALERT
    name: metric alert on test_metric
    metric: test_metric
    dataset: test_dataset
    filters:
      D1:
        - v1
        - v2
      D2:
        - v3
    dimensionExploration:
      dimensions:
        - D1
        - D2
      minContribution: 0.05
    rules:
      - detection:
          - type: THRESHOLD
            name: maxThreshold_1
            params:
              max: 100
        filter:
          - type: THRESHOLD_RULE_FILTER
            name: thresholdFilter_1
            params:
              min: 50
          - type: THRESHOLD_RULE_FILTER
            name: thresholdFilter_2
            params:
              min: 100
      - detection:
          - type: THRESHOLD
            name: maxThreshold_2
            params:
              max: 100
        filter:
          - type: THRESHOLD_RULE_FILTER
            name: thresholdFilter_3
            params:
              min: 50
  - type: COMPOSITE_ALERT
    name: composite alert on entity
    alerts:
      - type: METRIC_ALERT
        name: metric alert on test_metric
        metric: test_metric
        dataset: test_dataset
        rules:
          - detection:
              - type: THRESHOLD
                name: maxThreshold_3
                params:
                  max: 100
      - type: METRIC_ALERT
        name: metric alert on test_metric
        metric: test_metric
        dataset: test_dataset
        rules:
          - detection:
              - type: THRESHOLD
                name: maxThreshold_4
                params:
                  max: 100
