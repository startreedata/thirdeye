{
  "name": "pageviews",
  "description": "This is a sample detection",
  "template": {
    "nodes": [
      {
        "name": "root",
        "type": "AnomalyDetector",
        "params": {
          "component.percentageChange": "${percentageChange}",
          "component.monitoringGranularity": "P1D",
          "component.metric": "met",
          "component.timestamp": "ts",
          "anomaly.metric": "${metric}",
          "component.timezone": "US/Pacific",
          "anomaly.source": "pageviews/root",
          "type": "PERCENTAGE_CHANGE",
          "component.offset": "${offset}",
          "component.pattern": "${pattern}"
        },
        "inputs": [
          {
            "targetProperty": "baseline",
            "sourcePlanNode": "baselineMissingDataManager",
            "sourceProperty": "baselineOutput"
          },
          {
            "targetProperty": "current",
            "sourcePlanNode": "currentMissingDataManager",
            "sourceProperty": "currentOutput"
          }
        ],
        "outputs": []
      },
      {
        "name": "baselineMissingDataManager",
        "type": "TimeIndexFiller",
        "params": {
          "component.timestamp": "ts"
        },
        "inputs": [
          {
            "sourcePlanNode": "baselineDataFetcher",
            "sourceProperty": "baselineOutput"
          }
        ],
        "outputs": [
          {
            "outputName": "baselineOutput"
          }
        ]
      },
      {
        "name": "baselineDataFetcher",
        "type": "DataFetcher",
        "params": {
          "component.dataSource": "${dataSource}",
          "component.tableName": "${dataset}",
          "component.query": "SELECT __timeGroup(\"${timeColumn}\", ${timeColumnFormat}, ${monitoringGranularity}) as ts, ${metric} as met FROM ${dataset} WHERE __timeFilter(\"${timeColumn}\", ${timeColumnFormat}, ${lookback}, ${lookback}) GROUP BY ts ORDER BY ts LIMIT 10000"
        },
        "inputs": [],
        "outputs": [
          {
            "outputKey": "pinot",
            "outputName": "baselineOutput"
          }
        ]
      },
      {
        "name": "currentMissingDataManager",
        "type": "TimeIndexFiller",
        "params": {
          "component.timestamp": "ts"
        },
        "inputs": [
          {
            "sourcePlanNode": "currentDataFetcher",
            "sourceProperty": "currentOutput"
          }
        ],
        "outputs": [
          {
            "outputName": "currentOutput"
          }
        ]
      },
      {
        "name": "currentDataFetcher",
        "type": "DataFetcher",
        "params": {
          "component.dataSource": "${dataSource}",
          "component.tableName": "${dataset}",
          "component.query": "SELECT __timeGroup(\"${timeColumn}\", ${timeColumnFormat}, ${monitoringGranularity}) as ts, ${metric} as met FROM ${dataset} WHERE __timeFilter(\"${timeColumn}\", ${timeColumnFormat}) GROUP BY ts ORDER BY ts LIMIT 10000"
        },
        "inputs": [],
        "outputs": [
          {
            "outputKey": "pinot",
            "outputName": "currentOutput"
          }
        ]
      }
    ],
    "metadata": {
      "datasource": {
        "name": "${dataSource}"
      },
      "dataset": {
        "name": "${dataset}"
      },
      "metric": {
        "name": "views"
      }
    }
  },
  "templateProperties": {
    "dataSource": "PinotContainer",
    "dataset": "pageviews",
    "metric": "sum(views)",
    "monitoringGranularity": "P1D",
    "timeColumn": "AUTO",
    "timeColumnFormat": "",
    "percentageChange": "0.2",
    "offset": "wo1w",
    "lookback": "P7D",
    "pattern": "up_or_down"
  },
  "cron": "0 */15 * * * ?"
}
