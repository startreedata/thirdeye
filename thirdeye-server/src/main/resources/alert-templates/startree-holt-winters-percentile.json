{
  "name": "startree-holt-winters-percentile",
  "description": "Holt-Winters template. Aggregation function with 2 operands: PERCENTILETDIGEST, DISTINCTCOUNTHLL,etc...",
  "nodes": [
    {
      "name": "root",
      "type": "AnomalyDetector",
      "params": {
        "component.metric": "met",
        "component.monitoringGranularity": "${monitoringGranularity}",
        "component.lookbackPeriod": "${lookback}",
        "component.timestamp": "ts",
        "anomaly.metric": "${aggregationColumn}",
        "anomaly.dataset": "${dataset}",
        "anomaly.source": "holtwinters-template/root",
        "type": "HOLT_WINTERS",
        "component.pattern": "${pattern}",
        "component.sensitivity": "${sensitivity}",
        "component.seasonalityPeriod": "${seasonalityPeriod}",
        "component.alpha": "${alpha}",
        "component.beta": "${beta}",
        "component.gamma": "${gamma}"
      },
      "inputs": [
        {
          "targetProperty": "current",
          "sourcePlanNode": "missingDataPointsFiller",
          "sourceProperty": "preparedCurrentDataWithHistory"
        }
      ],
      "outputs": []
    },
    {
      "name": "missingDataPointsFiller",
      "type": "TimeIndexFiller",
      "inputs": [
        {
          "sourcePlanNode": "currentDataWithHistoryFetcher",
          "sourceProperty": "currentDataWithHistory"
        }
      ],
      "outputs": [
        {
          "outputName": "preparedCurrentDataWithHistory"
        }
      ]
    },
    {
      "name": "currentDataWithHistoryFetcher",
      "type": "DataFetcher",
      "params": {
        "component.dataSource": "${dataSource}",
        "component.query": "SELECT __timeGroup(\"${timeColumn}\", '${timeColumnFormat}', '${monitoringGranularity}') as ts, ${aggregationFunction}(\"${aggregationColumn}\", ${aggregationParameter}) as met FROM ${dataset} WHERE __timeFilter(ts, '${lookback}') ${queryFilters} GROUP BY ts ORDER BY ts LIMIT ${queryLimit}"
      },
      "inputs": [],
      "outputs": [
        {
          "outputKey": "currentDataWithHistory",
          "outputName": "currentDataWithHistory"
        }
      ]
    }
  ],
  "metadata": {
    "datasource": {
      "name": "${dataSource}"
    },
    "dataset": {
      "name": "${dataset}",
      "completenessDelay": "${completenessDelay}"
    },
    "metric": {
      "name": "${aggregationColumn}",
      "where": "${queryFilters}"
    },
    "timezone": "${timezone}",
    "granularity": "${monitoringGranularity}"
  },
  "defaultProperties": {
    "timezone": "UTC",
    "pattern": "UP_OR_DOWN",
    "completenessDelay": "P0D",
    "queryFilters": "",
    "queryLimit": "100000000",
    "seasonalityPeriod": "P7D",
    "alpha": "-1",
    "beta": "-1",
    "gamma": "-1"
  }
}
