{
  "name": "startree-percentage-rule",
  "description": "Percentage rule template. Aggregation function with 1 operand: SUM, MAX,etc...",
  "nodes": [
    {
      "name": "root",
      "type": "AnomalyDetector",
      "params": {
        "component.percentageChange": "${percentageChange}",
        "component.monitoringGranularity": "${monitoringGranularity}",
        "component.metric": "met",
        "component.timestamp": "ts",
        "anomaly.metric": "${aggregationColumn}",
        "anomaly.source": "percentage-change-template/root",
        "type": "PERCENTAGE_CHANGE",
        "component.pattern": "${pattern}"
      },
      "inputs": [
        {
          "targetProperty": "baseline",
          "sourcePlanNode": "baselineMissingDataManager",
          "sourceProperty": "baselineOutput"
        },
        {
          "targetProperty": "current",
          "sourcePlanNode": "currentMissingDataManager",
          "sourceProperty": "currentOutput"
        }
      ],
      "outputs": []
    },
    {
      "name": "baselineMissingDataManager",
      "type": "TimeIndexFiller",
      "inputs": [
        {
          "sourcePlanNode": "baselineDataFetcher",
          "sourceProperty": "baselineOutput"
        }
      ],
      "outputs": [
        {
          "outputName": "baselineOutput"
        }
      ]
    },
    {
      "name": "baselineDataFetcher",
      "type": "DataFetcher",
      "params": {
        "component.dataSource": "${dataSource}",
        "component.query": "SELECT __timeGroup(\"${timeColumn}\", '${timeColumnFormat}', '${monitoringGranularity}') as ts, ${aggregationFunction}(${aggregationColumn}) as met FROM ${dataset} WHERE __timeFilter(ts, '${baselineOffset}', '${baselineOffset}') GROUP BY ts ORDER BY ts LIMIT 1000"
      },
      "inputs": [],
      "outputs": [
        {
          "outputKey": "pinot",
          "outputName": "baselineOutput"
        }
      ]
    },
    {
      "name": "currentMissingDataManager",
      "type": "TimeIndexFiller",
      "inputs": [
        {
          "sourcePlanNode": "currentDataFetcher",
          "sourceProperty": "currentOutput"
        }
      ],
      "outputs": [
        {
          "outputName": "currentOutput"
        }
      ]
    },
    {
      "name": "currentDataFetcher",
      "type": "DataFetcher",
      "params": {
        "component.dataSource": "${dataSource}",
        "component.query": "SELECT __timeGroup(\"${timeColumn}\", '${timeColumnFormat}', '${monitoringGranularity}') as ts, ${aggregationFunction}(${aggregationColumn}) as met FROM ${dataset} WHERE __timeFilter(ts) GROUP BY ts ORDER BY ts LIMIT 1000"
      },
      "inputs": [],
      "outputs": [
        {
          "outputKey": "pinot",
          "outputName": "currentOutput"
        }
      ]
    }
  ],
  "metadata": {
    "datasource": {
      "name": "${dataSource}"
    },
    "dataset": {
      "name": "${dataset}",
      "completenessDelay": "${completenessDelay}"
    },
    "metric": {
      "name": "${aggregationColumn}"
    },
    "granularity": "${monitoringGranularity}"
  }
}
